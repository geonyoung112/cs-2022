# DNS

## 기본 지식

흔히 인터넷에 연결된 컴퓨터 한대 한대를 "호스트"라고 한다.
이 호스트끼리 서로 통신을 하기 위해서는 서로에 대한 주소가 필요하다.
이를 위해서 사용하는 주소를 ip 주소라고 부른다.

하지만 ip 주소를 하나하나 기억하는 것 어려움---> 그래서 DNS(Domain Name System)가 만들어졌다.
그리고 dns의 핵심은 이 dns 서버에 수많은 ip 주소의 도메인 이름이 저장되어 있다.

1. 우리가 주소창 www.naver.com 입력
2. 운영체제는 dns 서버에 접속해서 www.naver.com의 ip 주소를 찾는다.
3. dns 서버는 우리의 컴퓨터가 ip 주소에 해당하는 컴퓨터에 접속하게 해준다.

## DNS 동작 원리

앞서 말했듯이, 웹사이트의 데이터가 저장되어 있는 호스팅 서버는 인터넷 회선이 연결된 컴퓨터/장치이기 때문에 ip 주소가 할당되어 있고 이 주소가 실제 웹사이트 주소라 할 수 있다. 그래서 DNS 서버는 ip 주소를 특정 도메인 주소와 같다는 기록을 저장해두고, 인터넷 사용자들이 도메인 주소를 검색했을 때 ip 주소로 연결되도록 해준다.

![image description](https://gentlysallim.com/wp-content/uploads/2021/03/210111_02.jpg)

예시:
한 사람이 브라우저에서 Nesite.com을 검색했다면, 먼저 DNS 서버로 도메인 주소가 전달이 된다. 그리고 서버 내부에서 도메인 주소를 토대로 "Nesite.com = 12.123.123.123"이라는 항목을 찾아낸다.
다시 브라우저에게 12.123.123.123의 IP 주소를 갖고 있는 호스팅 서버(해당 웹사이트 데이터가 저장된 곳)로 가라고 지시한다. 그러면 브라우저가 다시 IP 주소로 접속해서 웹사이트가 보이게 된다.
그래서 우리가 사이트를 접속할 때 브라우저가 잠깐 사이에 이런 과정을 처리한다.

## DNS 서버 종류 구분

현재 우리는 도메인 수가 너무 많다.
그래서 DNS 서버 종류를 계층화해서 단계적으로 처리한다.
특히, 도메인의 총 관리는 ICANN에서 하기 때문에, DNS 서버도 최상위 도메인에서 개인 도메인의 서브 도메인까지 도메인 이름의 분류와 마찬가지로 디렉토리/계층 형태로 구분된다는 걸 생각하면 더 쉽게 이해할 수 있을 거라고 봄.

![image description](https://gentlysallim.com/wp-content/uploads/2021/03/210111_03.jpg)

> 캐시(cache, 문화어: 캐쉬, 고속완충기, 고속완충기억기)는 컴퓨터 과학에서 데이터나 값을 미리 복사해 놓는 임시 장소를 가리킨다. 캐시는 캐시의 접근 시간에 비해 원래 데이터를 접근하는 시간이 오래 걸리는 경우나 값을 다시 계산하는 시간을 절약하고 싶은 경우에 사용한다.

- Root DNS Server: ICANN이 직접 관리하는 서버로, TLD DNS 서버 IP들을 저장해두고 안내하는 역할을 한다.

- TLD(최상위 도메인) DNS Server: 도메인 등록 기관(Registry)이 관리하는 서버로, Authoritative DNS 서버 주소를 저장해두고 안내하는 역할을 한다.

- Authoritative DNS Server: 실제 개인 도메인과 IP 주소의 관계가 기록/저장/변경되는 서버. 그래서 권한의 의미인 Authoritative가 붙는다. 일반적으로 도메인/호스팅 업체의 ‘네임서버’를 말하지만, 개인 DNS 서버 구축을 한 경우에도 여기에 해당한다.

- Recursive DNS Server: 인터넷 사용자가 가장 먼저 접근하는 DNS 서버이다. 또 한 번 거친 후 얻은 데이터를 일정 기간(TTL/Time to Live) 동안 캐시라는 형태로 저장해 두는 서버이다. 직접 도메인과 IP 주소의 관계를 기록/저장/변경하지는 않고 캐시만을 보관하기 때문에, Authoritative와 비교되는 의미로 반복의 Recursive가 붙는다. 대표적으로 KT/LG/SK와 같은 ISP(통신사) DNS 서버가 있고, 구글 DNS, 클라우드플레어와 같은 Public DNS 서버도 있다.

거의 DNS 서버는 모두 위 4가지 DNS 서버 종류 중 하나에 속한다.
특히, 브라우저는 캐시가 저장된 Recursive 서버를 사용하고, 실제 네임서버를 설정하는 곳은 Authoritative 서버라는 점만 주의해서 이해하면 가장 좋다.

## 전체적인 DNS 동작 원리

![image description](https://gentlysallim.com/wp-content/uploads/2021/03/210111_03_2.jpg)

**과정**

1.  브라우저에서 Nesite.com을 검색하고, 사용하고 있는 통신사인 KT DNS 서버에게 도메인 주소에 해당하는 IP 주소를 요청한다.
    (브라우저 기본 DNS 설정이 통신사 DNS 서버이기 때문이다.)

2.  ISP 서버에선 캐시 데이터가 없다는 걸 확인하고 루트 DNS 서버에게 어디로 가야 하는지 요청한다. (캐시가 있다면 8.로 건너 뛴다.)

3.  루트 서버는 TLD DNS 서버 주소만 관리하기 때문에, \*\*\*.com 도메인을 보고는 COM 최상위 도메인을 관리하는 TLD DNS 서버 주소를 안내한다.

4.  ISP 서버는 COM 서버에게 어디로 가야 하는지 다시 요청한다.

5.  COM 서버는 가비아 DNS 서버에서 해당 도메인이 관리되고 있는 걸 확인하고 안내한다.

6.  ISP 서버는 가비아 서버에게 또 다시 요청한다.

7.  가비아 서버는 “Nesite.com = 12.123.123.123”이라는 정보를 확인하고 이 IP를 알려준다. 동시에 ISP 서버는 해당 정보를 캐시로 기록해 둔다.

8.  ISP 서버는 브라우저에게 힘들게 알아 낸 12.123.123.123 주소를 안내한다.

9.  브라우저는 12.123.123.123 IP 주소를 갖고 있는 서버 호스팅에게 웹사이트를 출력하라고 요청한다.

> 서버호스팅(Server Hosting)은 서버와 호스팅의 합성어로, 서버를 호스팅할 수 있는 공간과 회선을 임대해주는 서비스이다.

10. 요청한 사이트를 볼 수 있게 된다.
